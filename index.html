<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Financial nn : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Financial nn</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/nweidler/financial_nn">View on GitHub</a>

          <h1 id="project_title">Financial nn</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/nweidler/financial_nn/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/nweidler/financial_nn/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="beating-the-sp-500-using-a-neural-network" class="anchor" href="#beating-the-sp-500-using-a-neural-network" aria-hidden="true"><span class="octicon octicon-link"></span></a>Beating the S&amp;P 500 Using a Neural Network</h1>

<h3>
<a id="why-beat-a-buy-and-hold-strategy" class="anchor" href="#why-beat-a-buy-and-hold-strategy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why Beat a Buy and Hold Strategy?</h3>

<p>To make more money!
Wouldn't it be great to be able to teach a computer how to trade profitably and then sit back while it did all the work?  That is what this project is dedicated to.  Teaching a computer to make more money for you in the stock market then just buying the S&amp;P 500 and holding it forever.  The reason for this is to increase my net worth, and just maybe yours too. </p>

<h3>
<a id="what" class="anchor" href="#what" aria-hidden="true"><span class="octicon octicon-link"></span></a>What</h3>

<p>Technical analysis of the stock market has been around since the Dutch markets in the 17th century according to Wikipedia.  It is a method of predicting the future prices of securities by studying past market behavior.  Specifically technical analysis includes finding patterns in past price and volume data.  These patterns are then applied to the stock market in real-time.  I would like to teach a computer how to find patterns in historical stock market data and then look for those patterns developing in real-time in the stock market.  This is a very interesting problem because technician have use this same technique for hundreds of years to profit.  If a human can recognize these patterns in charts, a computer can also be trained to do so.  The difference is that a computer can do it more efficiently and react to the patterns much faster than any human could, maximizing profits.</p>

<h1>
<a id="the-big-idea" class="anchor" href="#the-big-idea" aria-hidden="true"><span class="octicon octicon-link"></span></a>the BIG idea</h1>

<p>So now that we have a general understanding, the question is how can we teach a computer to make us money?  The answer is simple.  Neural Networks.</p>

<p>Neural Networks are systems where interconnected "neurons" work together to find a solution.  They are presented with a set of inputs and based on previous experience or training they are able to come up with an expected output.  Neural networks have been used for handwriting recognition, speech recognition, image recognition and many other things.  Neural networks are able to recognize patterns, even in some cases patterns that their programmers didn't know were there.  For this reason my hope is that I can design a neural network that will be able to recognize patterns in the stock market and make profitable predictions based on those patterns.</p>

<p>The neural network I am using is based on a website (<a href="http://iamtrask.github.io/2015/07/12/basic-python-network/">http://iamtrask.github.io/2015/07/12/basic-python-network/</a>) entitled "A Neural Network in 11 lines of Python."  The second neural network presented on that site is a simple one with one hidden layer and 4 inputs.  I have expanded this network to still have a single hidden layer, but my network contains 25 inputs.  A neural network needs to have sufficient inputs to find relevant data.</p>

<h4>
<a id="inputs" class="anchor" href="#inputs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Inputs</h4>

<p>The question of what should the inputs be is a complicated one.  I have chosen technical indicators for the SPY, an ETF that tracks the S&amp;P 500, to be my inputs.  There are many technical indicators to choose from, but I have boiled it down to use <a href="#moving-average-convergence-divergence-macd">MACD</a>, <a href="#relative-strength-index-rsi">RSI</a>, <a href="#average-true-range-atr">ATR</a> and the <a href="#simple-moving-average-sma">SMA-10-day</a>.  These were chosen because each of them can create valid buy and sell signals, but they can create false signals as well.  They also examine various aspects of the underlying security.  RSI is a momentum indicator while ATR is a volatility indicator.  MACD is a trend indicator.  The 10 day SMA is added as a smoothing factor to the neural network.  The hope is that in combining momentum, volatility and trend into a single decision more accurate predictions will be made.
In order to supply the neural network with more information, these technical indicators are examined for buy signals, as well as compared to themselves yesterday and two days ago in order to detect the trend.  The neural network isn't just getting a snapshot of a single day, but will be getting three days worth of information to base its decision.  It will hopefully be able to not only see that a stock is overbought, but will be able to see that it is more overbought than yesterday and the day before.  Or perhaps it will see that it was overbought for the past two days and today it isn't, so maybe that is a good time to buy?  We'll leave it up to the neural network to make the connections, but these are just given as examples to what I hope will be learned.</p>

<h4>
<a id="expected-outputs" class="anchor" href="#expected-outputs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Expected Outputs</h4>

<p>In order to train the neural network a training set needs to be compiled.  This includes a set of past inputs paired with a set of expected outputs.  Building the set of inputs is straightforward.  You just need historical data converted into input format.  The set of expected outputs is more complicated to generate.  Again, historical data is used to form these.  To build the training data I allow the system to risk 1% of its working capital.  Each morning I simulate a buy of the S&amp;P 500.  I then look forward in historical data to see when the trade would be stopped buy loosing 1%.  At the time of the stop if I made more than 5% I call that a buy and set the expected output to 1 for that day.  Otherwise it is set to 0.  Below is a code snippet showing how I setup the expected output training data.</p>

<p><img src="https://cloud.githubusercontent.com/assets/10660367/11338993/733cae56-91b4-11e5-9cc5-ac91ed0c14b4.PNG" alt="output_code"></p>

<h3>
<a id="current-state-of-the-neural-network" class="anchor" href="#current-state-of-the-neural-network" aria-hidden="true"><span class="octicon octicon-link"></span></a>Current State of the Neural Network</h3>

<p>Runs for 265 trading days, but the error doesn't reduce to a usable number.  The neural network is still not being trained, the data still looks random.</p>

<h3>
<a id="results" class="anchor" href="#results" aria-hidden="true"><span class="octicon octicon-link"></span></a>Results</h3>

<h4>
<a id="example-of-error-reduction" class="anchor" href="#example-of-error-reduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example of Error Reduction</h4>

<p><img src="https://cloud.githubusercontent.com/assets/10660367/11338320/a0750f52-91b0-11e5-9ac7-3e69fc420e60.PNG" alt="error_good"></p>

<h4>
<a id="my-error-reduction" class="anchor" href="#my-error-reduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>My Error Reduction</h4>

<p><img src="https://cloud.githubusercontent.com/assets/10660367/11338325/a7c3728a-91b0-11e5-97cf-edb80f06e906.PNG" alt="error_chart"></p>

<h4>
<a id="my-error-changing" class="anchor" href="#my-error-changing" aria-hidden="true"><span class="octicon octicon-link"></span></a>My Error Changing</h4>

<p><img src="https://cloud.githubusercontent.com/assets/10660367/11338321/a63ec478-91b0-11e5-9a5d-699bc98e1f5f.PNG" alt="error_changing"></p>

<h4>
<a id="my-error-settling" class="anchor" href="#my-error-settling" aria-hidden="true"><span class="octicon octicon-link"></span></a>My Error Settling</h4>

<p><img src="https://cloud.githubusercontent.com/assets/10660367/11338330/aa6b163c-91b0-11e5-9e56-396330c3a011.PNG" alt="errors_end"></p>

<h3>
<a id="platform" class="anchor" href="#platform" aria-hidden="true"><span class="octicon octicon-link"></span></a>Platform</h3>

<p>I have decided to use Quantopian as a tool to help expand my wealth.  Quantopian is a "crowd-sourced hedge fund that provides the world's first browser-based algorithmic trading platform. On our platform, you can write code to execute your investment strategies, instead of relying on manual trades and emotional urges."  (Quote taken from <a href="https://www.quantopian.com/faq">https://www.quantopian.com/faq</a>)
The idea behind Quantopian is that they provide an in-browser platform which allows the user to write python algorithms to trade the stock market.  You are provided with years of historical data and functions which help you access that data efficiently.  They have built in functions to run back tests and provide useful feedback as to your algorithms risks and rewards.
Quantopian does have its drawbacks however.  It is relatively new and it currently only supports 20 python modules that can be imported.  This makes some things more difficult but I decided to give it a try.  If you are interested in this type of thing I would recommend you try it out as well.  Quantopian recently joined forces with RobinHood (a commission free trading platform) to allow you to trade real money with algorithms created and tested on Quantopian.</p>

<h3>
<a id="chosen-technical-indicators" class="anchor" href="#chosen-technical-indicators" aria-hidden="true"><span class="octicon octicon-link"></span></a>Chosen Technical Indicators</h3>

<h4>
<a id="moving-average-convergence-divergence-macd" class="anchor" href="#moving-average-convergence-divergence-macd" aria-hidden="true"><span class="octicon octicon-link"></span></a>Moving Average Convergence Divergence (MACD)</h4>

<p>The MACD helps traders determine the future movement in a given security.  The MACD incorporates several moving averages into a single signal to find trends in a stock.  This technical indicator consists of two chart lines the MACD line and the signal line.  The MACD line is made up of the difference between the 26 day exponential moving average and the 12 day exponential moving average.  The signal line is made up of the 9 day moving average.  When the MACD is below the signal line and crosses above it this is a bullish signal, or a signal to buy.  When the MACD is above the signal line and crosses under it this is considered a bearish or sell signal.</p>

<p>The MACD indicator is illustrated in the chart below.  The MACD is drawn below a price chart of an unnamed stock. The solid line is the MACD and the dotted line is the signal line.  As can be seen at the arrow labeled "Downward Cross," when the MACD line crosses below the signal line the price of the stock (drawn above) falls.  Then at the arrow labeled "Upward Cross" the MACD line crosses above the signal line and the price of the security subsequently increases.</p>

<p><img src="https://cloud.githubusercontent.com/assets/10660367/11763082/12c1ac74-a0ba-11e5-98cf-79fcfeb4790f.PNG" alt="macd"></p>

<h4>
<a id="relative-strength-index-rsi" class="anchor" href="#relative-strength-index-rsi" aria-hidden="true"><span class="octicon octicon-link"></span></a>Relative Strength Index (RSI)</h4>

<p>The RSI is a technical indicator that allows uses momentum to create buy and sell signals.  It basically compares the magnitude of recent gains to recent losses.  The formula for computing this is as follows: RS = Average of x days' up closes / Average of x days' down closes.  Plug RS into the following formula to get: RSI = 100 - 100/(1 + RS).  A typical value for x (and the one I used) is 14 days.  So What this formula does is takes the average daily gain of a stock divided by the average daily loss of a stock over a 14 day period.  It then normalizes those results to be between 0 and 100.  If the RSI of a stock is below 30 it is considered oversold and may be due to increase in price.  If the RSI of a stock is above 70 it is considered overbought and a decline in stock price may be expected.  </p>

<p>The chart below shows the RSI plotted under a nameless stock.  Times when the RSI is oversold (under 30) and overbought (above 70) are indicated by a red circle.  As can be seen by the activity of the stock price above the RSI often and overbought signal will see an increase in stock price, but it isn't always immediate.</p>

<p><img src="https://cloud.githubusercontent.com/assets/10660367/11763258/ad0f2fd0-a0c0-11e5-9657-582864c38ab1.PNG" alt="rsi"></p>

<h4>
<a id="average-true-range-atr" class="anchor" href="#average-true-range-atr" aria-hidden="true"><span class="octicon octicon-link"></span></a>Average True Range (ATR)</h4>

<p>ATR is a volatility indicator for financial markets.  Volatility is an important indicator which measures the strength of the price action, it can be used to separate "strong" moves from "weak" moves.  Obviously we want to participate in the strong moves.  Alone the ATR doesn't give an indication of which direction the price of a stock will move, but only how volatile the move will be.  However, many trades use a strategy in which the ATR is added to the previous day's close.  Then the next day if the price of a stock is greater than the previous close + the ATR that is considered a buy signal.  Like the other indicators, ATR uses several days of data to come up with it's value.  In this case we again are using 14 days.  The formula is as follows :  Current ATR = [(Prior ATR x 13) + Current TR] / 14 where the TR is the high-low for the day.  The formula needs a beginning, so for the first day the ATR is simply the high minus the low, and from there on the formula works out.</p>

<p>Below is a chart indicating a buy strategy using the ATR.  The black line is the price of the SPY, an S&amp;P 500 exchange traded fund.  The previous days close is added to the ATR and that is indicated by a red dot.  Buy signals are generated when the price rises above the red dot for the day.</p>

<p><img src="https://cloud.githubusercontent.com/assets/10660367/11763327/600f8696-a0c3-11e5-8280-81d2c027bc7a.PNG" alt="atr"></p>

<h4>
<a id="simple-moving-average-sma" class="anchor" href="#simple-moving-average-sma" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simple Moving Average (SMA)</h4>

<p>The Simple Moving Average is the mean of the price of a stock over a certain period.  For example, to calculate the 10 day SMA you add together the price of the stock for the last 10 days and then divide it by 10.  The longer the period the smoother and less reactive the SMA will be.  Moving averages as little as a couple days and as many as 17 months are used by traders.  We will use the 10 day moving average to generate buy and sell signals.  When the price of a stock is below the 10 day moving average then that stock is in a downward trend.  This is saying that todays price is less than the average of the last 10 days.  The opposite is true when the price of a stock is above the 10 day SMA.  This is illustrated below where the 20 day SMA is plotted as a solid black line over a candlestick chart of SPY.  </p>

<p><img src="https://cloud.githubusercontent.com/assets/10660367/11763393/d78e9598-a0c5-11e5-891c-e57c4c904427.PNG" alt="sma10"></p>

<h3>
<a id="code" class="anchor" href="#code" aria-hidden="true"><span class="octicon octicon-link"></span></a>Code</h3>

<p><a href="https://www.quantopian.com/algorithms/5639a0b7fb216fed200000bf">https://www.quantopian.com/algorithms/5639a0b7fb216fed200000bf</a></p>

<h3>
<a id="authors-and-contributors" class="anchor" href="#authors-and-contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<p>You can <a href="https://github.com/blog/821" class="user-mention">@mention</a> a GitHub username to generate a link to their profile. The resulting <code>&lt;a&gt;</code> element will link to the contributor’s GitHub Profile. For example: In 2007, Chris Wanstrath (<a href="https://github.com/defunkt" class="user-mention">@defunkt</a>), PJ Hyett (<a href="https://github.com/pjhyett" class="user-mention">@pjhyett</a>), and Tom Preston-Werner (<a href="https://github.com/mojombo" class="user-mention">@mojombo</a>) founded GitHub.</p>

<h3>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support or Contact</h3>

<p>Having trouble with Pages? Check out our <a href="https://help.github.com/pages">documentation</a> or <a href="https://github.com/contact">contact support</a> and we’ll help you sort it out.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Financial nn maintained by <a href="https://github.com/nweidler">nweidler</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
